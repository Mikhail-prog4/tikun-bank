# Тикун.Банк — Supabase + Serverless

## Структура проекта

- `public/` — статический фронтенд
- `api/` — serverless функции (Vercel)
- `supabase/` — SQL для схемы и RLS

## Запуск и деплой

### 1) Supabase
1. Создайте проект в Supabase.
2. Выполните `supabase/schema.sql` в SQL Editor.
3. Выполните `supabase/rls.sql`.
4. Выполните `supabase/seed.sql`.
5. Пароль админа по умолчанию: `admin123`.
6. При необходимости используйте кнопку “Сброс/инициализация базы” в админке.

### 2) Переменные окружения
Скопируйте `.env.example` в `.env` и заполните:
- `SUPABASE_URL`
- `SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`
- `ADMIN_JWT_SECRET`

### 3) Serverless API (Vercel)
1. `npm install`
2. Деплой в Vercel — папка `api/` станет endpoint’ами `/api/*`.

### 4) Фронтенд
Статика лежит в `public/` и будет опубликована вместе с Vercel. Публичные ключи
берутся через `/api/env` из переменных окружения.

## Проверка

### Публичная часть
- Откройте `/index.html` — рейтинг и неделя отображаются.
- Откройте `/shop.html` — товары видны, заявка создается.

### Админка
- Откройте `/admin.html` — логин по паролю.
- Проверьте:
  - Загрузка Excel пересчитывает рейтинг и баланс.
  - Ручное начисление/списание пишет историю.
  - Управление командами и товарами работает.
  - Одобрение заявки списывает тикуны один раз.
  - Кнопка “Сброс/инициализация базы” очищает данные и создаёт 22 команды и товары.
  - Кнопка “Скачать Excel-шаблон” сохраняет файл для тестового импорта.
  - Пароль можно сменить в блоке “Настройки”.

## Проверка после фикса

Команды:
- `npm run check`

Ожидаемый результат:
- Команда завершается без ошибок и выводит `Проверки пройдены`.
